"use strict";angular.module("unsavedChanges",["resettable"]).provider("unsavedWarningsConfig",function(){var f=this;var e=false;var b=true;var d=["$locationChangeStart","$stateChangeStart"];var c="You will lose unsaved changes if you leave this page";var a="You will lose unsaved changes if you reload this page";Object.defineProperty(f,"navigateMessage",{get:function(){return c},set:function(g){c=g}});Object.defineProperty(f,"reloadMessage",{get:function(){return a},set:function(g){a=g}});Object.defineProperty(f,"useTranslateService",{get:function(){return b},set:function(g){b=!!(g)}});Object.defineProperty(f,"routeEvent",{get:function(){return d},set:function(g){if(typeof g==="string"){g=[g]}d=g}});Object.defineProperty(f,"logEnabled",{get:function(){return e},set:function(g){e=!!(g)}});this.$get=[function(){var g={log:function(){if(console.log&&e&&arguments.length){var h=[].slice.call(arguments);if(typeof console.log==="object"){log.apply.call(console.log,console,h)}else{console.log.apply(console,h)}}}};Object.defineProperty(g,"useTranslateService",{get:function(){return b}});Object.defineProperty(g,"reloadMessage",{get:function(){return a}});Object.defineProperty(g,"navigateMessage",{get:function(){return c}});Object.defineProperty(g,"routeEvent",{get:function(){return d}});Object.defineProperty(g,"logEnabled",{get:function(){return e}});return g}]}).service("unsavedWarningSharedService",["$rootScope","unsavedWarningsConfig","$injector","$filter",function(l,d,m,k){var j=this;var a=[];var h=true;var e=[angular.noop];this.allForms=function(){return a};var g={navigate:d.navigateMessage,reload:d.reloadMessage};function i(){h=true;angular.forEach(a,function(o,n){d.log("Form : "+o.$name+" dirty : "+o.$dirty);if(o.$dirty){h=false}});return h}this.init=function(n){if(a.length===0){f()}d.log("Registering form",n);a.push(n)};this.removeForm=function(o){var n=a.indexOf(o);if(n===-1){return}a.splice(n,1);d.log("Removing form from watch list",o);if(a.length===0){b()}};function b(){d.log("No more forms, tearing down");angular.forEach(e,function(n){n()});window.onbeforeunload=null}this.confirmExit=function(){if(!i()){return c(g.reload)}l.$broadcast("resetResettables");b()};function c(n){if(m.has("$translate")&&d.useTranslateService){var o=k("translate");return o(n)}else{return n}}function f(){d.log("Setting up");window.onbeforeunload=j.confirmExit;var n=d.routeEvent;angular.forEach(n,function(o){var p=l.$on(o,function(r,q,s){d.log("user is moving with "+o);if(!i()){d.log("a form is dirty");if(!confirm(c(g.navigate))){d.log("user wants to cancel leaving");r.preventDefault()}else{d.log("user doesn't care about loosing stuff");l.$broadcast("resetResettables")}}else{d.log("all forms are clean")}});e.push(p)})}}]).directive("unsavedWarningClear",["unsavedWarningSharedService",function(a){return{require:"^form",priority:10,link:function(d,c,b,e){c.bind("click",function(f){e.$setPristine()})}}}]).directive("unsavedWarningForm",["unsavedWarningSharedService","$rootScope",function(b,a){return{require:"form",link:function(e,d,c,f){b.init(f);d.bind("submit",function(g){if(f.$valid){f.$setPristine()}});d.bind("reset",function(g){g.preventDefault();e.$apply(a.$broadcast("resetResettables"));f.$setPristine()});e.$on("$destroy",function(){b.removeForm(f)})}}}]);angular.module("resettable",[]).directive("resettable",["$parse","$compile","$rootScope",function(d,c,b){return{restrict:"A",link:function a(m,g,j,e){var h,k,l;j.$observe("ngModel",function(n){k=d(j.ngModel);h=k.assign;l=k(m)});var i=function(){h(m,l)};var f=m.$on("resetResettables",i);m.$on("$destroy",f)}}}]);